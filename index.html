<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCOE & PPA Solar Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Prompt:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.344.0/lucide.min.js"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="glass-container">
        <header>
            <h1>LCOE & PPA Solar Calculator</h1>
            <p>Investment Analysis Tool for EPC & Investors</p>
        </header>

        <div id="main-nav" class="tabs no-print">
            <button class="tab-btn active" onclick="app.switchTab('input-tab', this)">
                <i data-lucide="edit-3"></i> กรอกข้อมูล (Input)
            </button>
            <button class="tab-btn" onclick="app.switchTab('results-tab', this)">
                <i data-lucide="bar-chart-3"></i> สรุปผล (Report)
            </button>
            <button class="tab-btn" onclick="app.switchTab('payback-tab', this)">
                <i data-lucide="refresh-cw"></i> คืนทุน (Payback)
            </button>
            <button class="tab-btn" onclick="app.switchTab('investment-report-tab', this)">
                <i data-lucide="file-text"></i> Solar Investment Report
            </button>
            <div class="top-actions">
                <button class="btn secondary top-action-btn" onclick="app.exportData()">
                    <i data-lucide="save"></i> Save File
                </button>
                <button class="btn secondary top-action-btn" onclick="document.getElementById('import-file').click()">
                    <i data-lucide="upload"></i> Open File
                </button>
                <input type="file" id="import-file" class="hidden-input" onchange="app.importData(this)">
            </div>
        </div>

        <main>
            <div id="input-tab" class="tab-content active">
                <section id="global-settings" class="card">
                    <div class="card-header">
                        <i data-lucide="settings"></i>
                        <h2>Global Settings (ค่ากำหนดพื้นฐาน)</h2>
                    </div>
                    <div class="grid-inputs">
                        <div class="input-group">
                            <label>ระยะเวลาสัญญา (ปี)</label>
                            <input type="number" id="project-period" min="10" max="25">
                        </div>
                        <div class="input-group">
                            <label>WACC / Discount Rate (%)</label>
                            <input type="number" id="wacc" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Degradation (% / year)</label>
                            <input type="number" id="degradation" step="0.05">
                        </div>
                        <div class="input-group">
                            <label>Tariff Escalation (% / year)</label>
                            <input type="number" id="tariff-escalation" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>OPEX Inflation (% / year)</label>
                            <input type="number" id="opex-inflation" step="0.1">
                        </div>
                    </div>
                </section>

                <section id="supplier-section">
                    <div class="section-header">
                        <div class="section-header-row">
                            <h2>Supplier Comparison</h2>
                            <button class="btn secondary btn-sm" onclick="app.resetDefaults()">Reset
                                Data</button>
                        </div>
                        <p>กำหนดข้อมูลทางเทคนิคและค่าดำเนินงานของแต่ละราย (คลิก Active เพื่อเปิด/ปิด)</p>
                    </div>
                    <div id="supplier-container" class="supplier-grid"></div>
                </section>
            </div>

            <div id="results-tab" class="tab-content">
                <div class="section-header section-header-flex">
                    <div>
                        <h2>Solar Investment Report</h2>
                        <p>รายงานผลการวิเคราะห์ทางการเงินและเปรียบเทียบ Supplier</p>
                    </div>
                    <div class="chart-toolbar no-print">
                        <label for="export-preset-results">Export Preset:</label>
                        <select id="export-preset-results" class="chart-preset-select">
                            <option value="ppt">PowerPoint (16:9)</option>
                            <option value="report">Report (4:3)</option>
                            <option value="native">Native Size</option>
                        </select>
                        <button class="btn primary" onclick="window.print()"><i data-lucide="printer"></i> Print
                            Report (A4)</button>
                    </div>
                </div>

                <div class="results-container">
                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="chart-title-row">
                                    <h3>Levelized Cost & Profit Margin Analysis</h3>
                                    <div class="chart-action-group no-print">
                                    <button class="btn secondary chart-export-btn" onclick="app.exportChart('lcoe', 'lcoe_profit_chart.png', 'export-preset-results')">
                                        <i data-lucide="image-down"></i> Export PNG
                                    </button>
                                    <button class="btn secondary chart-export-btn" onclick="app.copyChartToClipboard('lcoe', 'export-preset-results')">
                                        <i data-lucide="copy"></i> Copy
                                    </button>
                                </div>
                                </div>
                                <div class="chart-container chart-container-xl"><canvas id="lcoeChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title-row">
                                    <h3>Power Generation - Solar Rooftop</h3>
                                    <div class="chart-action-group no-print">
                                    <button class="btn secondary chart-export-btn" onclick="app.exportChart('gen', 'generation_chart.png', 'export-preset-results')">
                                        <i data-lucide="image-down"></i> Export PNG
                                    </button>
                                    <button class="btn secondary chart-export-btn" onclick="app.copyChartToClipboard('gen', 'export-preset-results')">
                                        <i data-lucide="copy"></i> Copy
                                    </button>
                                </div>
                                </div>
                                <div class="chart-container chart-container-xl"><canvas id="genChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="year-table-section card">
                            <div class="card-header"><i data-lucide="calendar"></i>
                                <h2>Yearly Cash Flow Details</h2>
                            </div>
                            <div class="selector-group no-print chart-selector-row">
                                <label>เลือกดู Supplier:</label>
                                <select id="year-table-selector"></select>
                                <button id="export-csv-btn" class="btn secondary"><i data-lucide="download"></i> Export
                                    CSV</button>
                            </div>
                            <div class="table-responsive glass-table-container">
                                <table id="year-table">
                                    <thead>
                                        <tr>
                                            <th>Year</th>
                                            <th>Energy (kWh)</th>
                                            <th>Tariff (THB)</th>
                                            <th>Revenue (THB)</th>
                                            <th>OPEX (THB)</th>
                                            <th>Net CF (THB)</th>
                                            <th>Cumulative (M THB)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                </div>
            </div>

            <div id="investment-report-tab" class="tab-content">
                <div class="section-header section-header-flex">
                    <div>
                        <h2>Solar Investment Report</h2>
                        <p>รายงานผลการวิเคราะห์ทางการเงินและเปรียบเทียบ Supplier</p>
                    </div>
                    <div class="report-actions">
                        <button class="btn primary no-print" onclick="window.print()"><i data-lucide="printer"></i>
                            Print Report</button>
                    </div>
                </div>

                <div id="summary-cards-container" class="grid-inputs summary-cards-grid">
                    <!-- Cards injected here -->
                </div>

                <div class="card">
                    <div class="card-header"><i data-lucide="table"></i>
                        <h2>Result Summary</h2>
                    </div>
                    <div class="table-responsive glass-table-container">
                        <table id="summary-table">
                            <thead>
                                <tr id="summary-header-row">
                                    <th>Metric</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="remark-section">
                    <h4 class="remark-title">
                        <i data-lucide="info" class="remark-icon"></i> หมายเหตุการคำนวณ (Environmental
                        Impact)
                    </h4>
                    <ul class="remark-list">
                        <li class="remark-item">
                            <b>CO<sub>2</sub> Reduction:</b> คำนวณจากค่า Grid Emission Factor เท่ากับ <b>0.485
                                kgCO<sub>2</sub>/kWh</b>
                            <span class="remark-ref">(อ้างอิง: องค์การบริหารจัดการก๊าซเรือนกระจก
                                - TGO)</span>
                        </li>
                        <li>
                            <b>Equivalent Trees:</b> คำนวณจากการดูดซับคาร์บอนของต้นไม้ยืนต้น ประมาณ <b>9
                                kgCO<sub>2</sub>/ต้น/ปี</b>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="payback-tab" class="tab-content">
                <div class="section-header">
                    <h2>Cumulative Cash Flow Analysis</h2>
                    <p>แสดงจุดคืนทุน (Breakeven) และกระแสเงินทุนสะสมรายปี</p>
                </div>
                <div class="card payback-card" id="payback-container">
                    <div class="chart-header-row">
                        <h3 class="payback-title">Cumulative Cash Flow (Payback Years)</h3>
                        <div class="chart-controls">
                            <label class="chart-control-label">Display Mode:</label>
                            <select id="payback-mode-selector"
                                class="chart-preset-select"
                                onchange="app.renderCharts()">
                                <option value="overview">Overview (By Supplier)</option>
                                <option value="breakdown">Project Breakdown</option>
                            </select>
                            <select id="export-preset-payback" class="chart-preset-select">
                                <option value="ppt">PowerPoint (16:9)</option>
                                <option value="report">Report (4:3)</option>
                                <option value="native">Native Size</option>
                            </select>
                            <button class="btn secondary chart-control-btn"
                                onclick="app.exportChart('payback', 'payback_chart.png', 'export-preset-payback')">
                                <i data-lucide="image-down"></i> Export PNG
                            </button>
                            <button class="btn secondary chart-control-btn"
                                onclick="app.copyChartToClipboard('payback', 'export-preset-payback')">
                                <i data-lucide="copy"></i> Copy
                            </button>
                            <button class="btn secondary chart-control-btn"
                                onclick="app.charts.payback.resetZoom()">
                                <i data-lucide="zoom-out"></i> Reset Zoom
                            </button>
                        </div>
                    </div>
                    <div class="chart-container chart-container-xl chart-container-full">
                        <canvas id="paybackChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
        <footer>
            <p>&copy; 2026 P.manid Engineer Version 2</p>
        </footer>
    </div>

    <script src="constants.js"></script>
    <script src="calculator.js"></script>
    <script src="script.js"></script>
</body>

</html>